<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Custom Navigation Bar Background and Custom Buttons</title>
	<meta name="author" content="Roger Chapman" />
	<link href="http://feeds.feedburner.com/rogchap" rel="alternate" title="Roger Chapman" type="application/atom+xml" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" media="all" />
	<link rel="stylesheet" href="/css/screen.css" type="text/css" media="all" />
	<link rel="stylesheet" href="/css/tablet.css" type="text/css" media="screen and (min-width:651px) and (max-width: 1024px), screen and (min-device-width: 768px) and (max-device-width: 1024px)" />
	<link rel="stylesheet" href="/css/mobile.css" type="text/css" media="handheld, screen and (max-width: 650px), screen and (max-device-width: 480px)" />
</head>
<body>
	<div class="site">
		<div class="title"><a href="/">Roger Chapman<br/>rogchap</a></div>
		<div id="post">
	<h1>Custom Navigation Bar Background and Custom Buttons</h1>
	<p class="meta">21 Jun 2011</p>
	<p>The default <code>UINavigationBar</code> color is a bit boring and even changing the tint color only adds a little to the desired effect. More iPhone apps are displaying more “fancy” designs and the bulk standard navigation bar needs the same treatment.</p>

<p>This is the sort of navigation bar we are trying to achieve:</p>

<p><img src="http://rogchap.com/images/custom_nav.png" alt="Custom Nav" /></p>

<h2 id="navigation-bar-background">Navigation Bar background</h2>

<p>To change the background of the navigation bar be need to override the the <code>drawRect:</code> method, but I also only wanted to change the navigation background for the default navigation style. This way I could still have an app that can use the semi-transparent navigation bar when necessary. To achieve this we store the original <code>drawRect:</code> method and only override when the <code>barStyle</code> is equal to <code>UIBarStyleDefault</code>.</p>

<p>I placed this code at the end of my app delegate:</p>

<pre><code>#import &lt;objc/runtime.h&gt;

static void (*_origDrawRect)(id, SEL, CGRect);

static void OverrideDrawRect(UIToolbar *self, SEL _cmd, CGRect r) {
  if ( self.barStyle == UIBarStyleDefault ) {
    self.tintColor = UIColorFromRGB(0x008A35);
    [[UIImage imageNamed:@"top_navbar"] drawInRect:CGRectMake(0, 0, self.frame.size.width, self.frame.size.height)];
  } else {
    // Call default method
    _origDrawRect(self, _cmd, r);
  }
}

@implementation UINavigationBar (UINavigationBarCategory)

+ (void)load {
  Method origMethod = class_getInstanceMethod(self, @selector(drawRect:));
  _origDrawRect = (void *)method_getImplementation(origMethod);

  if(!class_addMethod(self, @selector(drawRect:), (IMP)OverrideDrawRect, method_getTypeEncoding(origMethod)))
    method_setImplementation(origMethod, (IMP)OverrideDrawRect);
}
</code></pre>

<p>This will now set the background of all <code>UINavigationBar</code>s to <code>top_navbar.png</code> for the default style. You can also use similar code to change <code>UITabBar</code>s.</p>

<h2 id="custom-navigation-bar-buttons">Custom Navigation Bar Buttons</h2>

<p>At this point your navigation bar will have your new background image but the buttons will still have the default look based on the tint color you specified. This maybe what you want but if you want custom buttons I created the following category:</p>

<pre><code>// UIBarButtonItem+Image.h

@interface UIBarButtonItem (Image)

-(id)initWithImage:(UIImage *)image title:(NSString*)title target:(id)target action:(SEL)action;

@end

//  UIBarButtonItem+Image.m

@implementation UIBarButtonItem (Image)

-(id)initWithImage:(UIImage *)image title:(NSString*)title target:(id)target action:(SEL)action {
  UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
  button.frame= CGRectMake(0.0, 0.0, image.size.width, image.size.height);
  button.titleLabel.font = [UIFont boldSystemFontOfSize:12];
  button.titleLabel.shadowOffset = CGSizeMake(0, -1);
  button.titleLabel.shadowColor = [UIColor colorWithWhite:0 alpha:0.5];

  [button setTitle:title forState:UIControlStateNormal];
  [button setBackgroundImage:image forState:UIControlStateNormal];
  [button addTarget:target action:action forControlEvents:UIControlEventTouchUpInside];

  UIView *view =[[UIView alloc] initWithFrame:CGRectMake(0.0, 0.0, image.size.width, image.size.height) ];
  [view addSubview:button];

  self = [[UIBarButtonItem alloc] initWithCustomView:view];

  [view release];
  [image release];

  return self;
}

-(void)setEnabled:(BOOL)enabled {
  if (self.customView) {
    if ([[self.customView.subviews objectAtIndex:0] isKindOfClass:[UIButton class]]) {
      ((UIButton*)[self.customView.subviews objectAtIndex:0]).enabled = enabled;
    }
  }
}
</code></pre>

<p>The <code>setEnabled</code> method allows you to set a disabled state on the <code>UIBarButtonItem</code> and that state be reflected in the custom button.</p>

<p>In order to use your custom button in the nav bar you must set the left/right bar button item:</p>

<pre><code>#import "UIBarButtonItem+Image.h"

self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"custom_button"] title:@"Cancel" target:self action:@selector(cancel)];
self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"custom_button_blue"] title:@"Continue" target:self action:@selector(continue)];
</code></pre>

<p>Your left and right button should now look like you custom buttons. One down side to this is that you would have to manually set the back button each time with a <code>popViewController</code> action if you wanted a custom back button, but that’s no real headache.</p>

<h2 id="bonus-uicolorfromrgb">Bonus: UIColorFromRGB</h2>

<p>You’ll have notice that I used a macro in the <code>OverrideDrawRect</code> method to set the tint color of the navigation bar:</p>

<pre><code>#define UIColorFromRGB(rgbValue) [UIColor colorWithRed:((float)((rgbValue &amp; 0xFF0000) &gt;&gt; 16))/255.0 green:((float)((rgbValue &amp; 0xFF00) &gt;&gt; 8))/255.0 blue:((float)(rgbValue &amp; 0xFF))/255.0 alpha:1.0]
</code></pre>

<p>This was a macro provided by <a href="http://cocoamatic.blogspot.com/2010/07/uicolor-macro-with-hex-values.html">Cocoa-Matic</a>.</p>


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
    <g:plusone></g:plusone>

</div>



<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>23 Aug 2013</span> <span class="seperator">~</span> <a href="/2013/08/23/custom-uiview-animations-with-vector-graphics/">Custom UIView Animations with Vector Graphics</a></li>
    
      <li><span>13 Aug 2013</span> <span class="seperator">~</span> <a href="/2013/08/13/simple-ios-dropdown-control-using-uitextfield/">Simple iOS Dropdown Control using UITextField</a></li>
    
      <li><span>07 Feb 2013</span> <span class="seperator">~</span> <a href="/2013/02/07/image-resize-middleware-for-expressjs/">Image Resize Middleware for Express.js</a></li>
    
  </ul>
</div>




<div class="ads">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Leaderboard -->
    <ins class="adsbygoogle"
         style="display:inline-block;width:728px;height:90px"
         data-ad-client="ca-pub-3092587044574000"
         data-ad-slot="3996431372"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

<div class="comments">
	<h3>Comments</h3>
	<noscript>Please enable JavaScript to view the comments</noscript>
	<div id="disqus_thread"></div>
</div>
<script type="text/javascript">
    var disqus_shortname = 'rogchap'; 
    var disqus_identifier = '/2011/06/21/custom-navigation-bar-background-and-custom-buttons';
    var disqus_url = 'http://rogchap.com/2011/06/21/custom-navigation-bar-background-and-custom-buttons/';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

		<div class="footer">
			<div class="contact">
				<p>
					Roger Chapman<br/>
					Application Development Evangelist<br/>
					&#114;&#111;&#103;&#99;&#104;&#97;&#112;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;
				</p>
			</div>
			<div class="contact">
				<p>
					<a href="http://github.com/rogchap/">github.com/rogchap</a><br />
					<a href="http://twitter.com/rogchap/">twitter.com/rogchap</a><br />
					<a href="http://linkedin.com/in/rogchap/">linkedin.com/in/rogchap</a>
				</p>
			</div>
		 	<div class="rss">
				<a href="http://feeds.feedburner.com/rogchap">RSS Feed</a>
			</div>
		</div>
	</div>

    <script type="text/javascript">
        var _gaq = _gaq || [];
        var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
        _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
        _gaq.push(['_setAccount', 'UA-4155555-8']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
<html>